<!-- cart -->

<head>
    <meta charset="UTF-8">
    <style data-styles="">
        ion-icon {
            visibility: hidden
        }

        .hydrated {
            visibility: inherit
        }

        .disabled1 {
            cursor: not-allowed;
            opacity: 0.5;
        }
    </style>
    </style>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="store-title"></title>

    <!-- 
    - favicon
  -->
    <link rel="shortcut icon" href="./favicon.svg" type="image/svg+xml">

    <!-- 
    - custom css link
  -->
    <link rel="stylesheet" href="./assets/css/style.css">

    <!-- 
    - google font link
  -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
    <link
        href="https://fonts.googleapis.com/css2?family=Josefin+Sans:wght@300;400;500;600;700&amp;family=Roboto:wght@400;500;700&amp;display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="./assets/js/static.js"></script>
    <script src="./assets/js/search-product.js"></script>
    <script src="./assets/js/Check-available.js"></script>
    <script src="./assets/js/updateshippingfees.js"></script>



</head>
<header class="header" data-header="">
    <div class="header__bar">Free Shipping On Orders Over <div class="m-x-3" id="free-shipping"></div> EGP</div>
    <div class="container">

        <div class="overlay" data-overlay=""></div>

        <a href="./index.html" class="logo">
            <img src="./assets/images/iicon.svg" width="160" height="50" alt="">
        </a>

        <button class="nav-open-btn" data-nav-open-btn="" aria-label="Open Menu">
            <ion-icon name="menu-outline" role="img" class="md hydrated" aria-label="menu outline"></ion-icon>
        </button>

        <nav class="navbar" data-navbar="">

            <button class="nav-close-btn black-font" data-nav-close-btn="" aria-label="Close Menu">
                <ion-icon name="close-outline" role="img" class="md hydrated" aria-label="close outline"></ion-icon>
            </button>

            <a href="#" class="logo bg-white">
                <img src="./assets/images/iicon.svg" width="190" height="50" alt="">
            </a>

            <ul class="navbar-list">
                <li class="navbar-item">
                    <a href="#" class="navbar-link" onclick="changeFrameSrc('index.html')">Home</a>
                </li>
                <!-- <li class="navbar-item">
                                        <a href="#" class="navbar-link" onclick="changeFrameSrc('About.html')">About</a>
                                    </li> -->
                <li class="navbar-item" id="megamenu" data-mega-menu>
                    <div class="flex align-items justify-content-space-between">
                        <a href="#" class="navbar-link" onclick="changeFrameSrc('Products.html')">Products</a>
                        <a id="open-category" class="rotate open-category open-category-btn"><i
                                class="bi bi-plus"></i></a>
                    </div>
                    <div class="mega-menu flex-direction-column" id="mega-menu">

                    </div>
                </li>
                <script>
                    document.addEventListener('DOMContentLoaded', () => {
                        // Select the navbar item that contains the mega menu
                        const navbarItem = document.getElementById('megamenu');
                        const toggleIcon = document.getElementById('open-category');
                        const categoryHeaders = document.querySelectorAll('.menu-category h4');

                        // Toggle mega menu display on click for smaller screens
                        toggleIcon.addEventListener('click', (e) => {
                            e.stopPropagation(); // Prevent triggering other click events
                            navbarItem.classList.toggle('active');

                            // Toggle icon rotation and change icon class
                            if (navbarItem.classList.contains('active')) {
                                toggleIcon.classList.add('rotate-360');
                                toggleIcon.classList.remove('rotate-back');
                                toggleIcon.innerHTML = '<i class="bi bi-dash"></i>';
                            } else {
                                toggleIcon.classList.add('rotate-back');
                                toggleIcon.classList.remove('rotate-360');
                                toggleIcon.innerHTML = '<i class="bi bi-plus"></i>';
                            }
                        });

                        // Add click event listeners to all category headers (h4)
                        categoryHeaders.forEach(header => {
                            header.addEventListener('click', (e) => {
                                e.stopPropagation(); // Prevent click from closing the navbar
                                const category = header.parentElement;
                                category.classList.toggle('active');
                            });
                        });

                        // Close mega menu when clicking outside
                        document.addEventListener('click', (e) => {
                            if (!navbarItem.contains(e.target)) {
                                navbarItem.classList.remove('active');
                                toggleIcon.classList.remove('rotate-360');
                                toggleIcon.classList.add('rotate-back');
                                toggleIcon.innerHTML = '<i class="bi bi-plus"></i>';
                            }
                        });
                    });

                </script>
                <li class="navbar-item">
                    <a href="#" class="navbar-link red-txt" onclick="changeFrameSrc('sale.html')">Sale</a>
                </li>

                <li class="navbar-item">
                    <a href="#" class="navbar-link" onclick="changeFrameSrc('Contact.html')">Contact</a>
                </li>
            </ul>
            <ul class="nav-action-list">

                <li class="li-action" id="search-li">


                </li>
                <li class="navbar-item li-action">
                    <button class="nav-action-btn" onclick="changeFrameSrc('Cart.html')">
                        <ion-icon name="bag-outline" aria-hidden="true" role="img" class="md hydrated"></ion-icon>
                        <data class="nav-action-text">Basket: <strong class="cart-amount" id="cart-amount">0
                                EÂ£</strong></data>
                        <data id="cartItemCount" class="nav-action-badge" aria-hidden="true">0</data>
                    </button>
                </li>
                <li class="navbar-item li-action">
                    <button class="nav-action-btn" onclick="changeFrameSrc('account.html')">
                        <ion-icon name="person-outline"></ion-icon>
                        <span class="nav-action-text">Account</span>
                    </button>
                </li>
                <li>
                    <button class="nav-action-btn hidden">
                        <ion-icon name="heart-outline" aria-hidden="true" role="img" class="md hydrated"></ion-icon>

                        <span class="nav-action-text">Wishlist</span>

                        <data class="nav-action-badge" value="5" aria-hidden="true">5</data>
                    </button>
                </li>
            </ul>

        </nav>

    </div>
</header>
<main>
    <div class="preloader" id="preloader">
        <img src="favicon.png" alt="Your Image" width="40" height="40">
        <div class="loader"></div>
    </div>

    <div class="product-area" id="product-area">
        <div class="progress-bar-container flex center">
            <div class="progress-bar flex center">
                <div class="step completed">
                    <span class="step-number targeted-step w-h-auto" id="target-1" onclick="perv1()">
                        <div class="flex center align-items p-4">
                            <i class="bi bi-bag-check"></i>
                        </div>
                    </span>
                    <span class="step-label">Cart</span>

                </div>
                <div id="connector1" class="connector"></div>
                <div class="step completed">
                    <span class="step-number w-h-auto" id="target-2">
                        <div class="flex center align-items p-4" onclick="Next1()">
                            <i class="bi bi-info-lg"></i>
                        </div>
                    </span>
                    <span class="step-label">Information</span>
                </div>
                <div id="connector2" class="connector"></div>
                <div class="step completed">
                    <span class="step-number w-h-auto" id="target-3" onclick="Next2()">
                        <div class="flex center align-items p-4">
                            <i class="bi bi-list-check"></i>
                        </div>
                    </span>
                    <span class="step-label">summary</span>
                </div>
                <div id="connector3" class="connector"></div>

                <div class="step completed">
                    <span class="step-number w-h-auto" id="target-4" onclick="Next3()">
                        <div class="flex center align-items p-4">
                            <i class="bi bi-credit-card"></i>
                        </div>

                    </span>
                    <span class="step-label">Payment</span>
                </div>

            </div>

        </div>
        <section class="section product p-0 mt-10">

            <div id="cart-card">
                <div class="flex center flex-direction-column flex-start m-10 height-70 " id="Cart">
                    <div class="m-10 flex center">
                        <h3>Shopping Cart</h3>
                    </div>
                    <div class="m-10 cart-bg over-flow-auto box-with-shadow flex-direction-column available-height"
                        id="cartarea">
                        <div class="flex center">

                            <ul id="cart-items">

                            </ul>

                            <script>
                                document.addEventListener("DOMContentLoaded", () => {
                                    let cart = JSON.parse(localStorage.getItem("cart")) || [];
                                    const cartList = document.getElementById("cart-items");
                                    const cartArea = document.getElementById("cartarea");
                                    let totalAmount = 0;

                                    // Function to check availability from Firebase database

                                    function checkAvailability(itemId, productSize, productColor, requestedQuantity, callback) {
                                        // Fetch the product data from Firebase database
                                        fetch(`${url}/Stores/${uid}/Products/${itemId}.json`)
                                            .then(response => response.json())
                                            .then(productsData => {
                                                let itemFound = false;
                                                let availableQty = 0;

                                                // Loop through the product data to find the correct item
                                                for (const key in productsData.sizes) {
                                                    if (key === productSize) {
                                                        const sizeData = productsData.sizes[key];
                                                        if (sizeData[productColor]) {
                                                            const colorData = sizeData[productColor];
                                                            availableQty = parseInt(colorData.qty, 10); // Get the available quantity
                                                            const colorImage = colorData.img1 || productsData["product-photo"]; // Use color image or fallback to main product photo

                                                            itemFound = true;

                                                            // Check if the requested quantity is available
                                                            if (requestedQuantity <= availableQty && requestedQuantity > 0) {
                                                                callback(true, availableQty); // Proceed if available
                                                            } else {
                                                                // Insufficient stock, update to the available quantity in local storage
                                                                Swal.fire({
                                                                    icon: "warning",
                                                                    html: `<div style="display: flex; align-items: center; gap: 10px;">
                                        <img src="${colorImage}" alt="${productsData["product-title"]}" 
                                            style="width: 50px; height: 50px; object-fit: cover; border-radius: 5px;" />
                                        <span>Only ${availableQty} items available of this product</span>
                                      </div>`,
                                                                }).then(() => {
                                                                    // Update the cart locally to the available quantity
                                                                    updateLocalDbItemQuantity(itemId, availableQty);
                                                                });

                                                                callback(false, availableQty); // Insufficient stock, update local DB
                                                            }

                                                            break;
                                                        }
                                                    }
                                                }

                                                if (!itemFound) {
                                                    Swal.fire({
                                                        icon: "error",
                                                        title: "Item Not Found",
                                                        text: "This item is no longer available.",
                                                    });
                                                    callback(false, availableQty); // Item not found
                                                }
                                            })
                                            .catch(error => {
                                                console.error("Error checking availability:", error);
                                                Swal.fire({
                                                    icon: "error",
                                                    title: "Error",
                                                    text: "There was an error checking availability. Please try again later.",
                                                });
                                                callback(false, 0); // Error
                                            });
                                    }


                                    function checkAndUpdateQuantities() {
                                        cart.forEach((item) => {
                                            checkAvailability(item.id, item.productSize, item.productColor, item.quantity, (isAvailable, availableQty) => {
                                                if (!isAvailable) {
                                                    // If not available, update the local storage item quantity
                                                    updateLocalDbItemQuantity(item.id, availableQty);
                                                }
                                            });
                                        });
                                    }

                                    // Function to update quantity in the cart
                                    function updateQuantity(index, increment) {
                                        const item = cart[index];

                                        // Determine the requested quantity after increment or decrement
                                        const requestedQuantity = item.quantity + increment;

                                        // Ensure the requested quantity is never less than 1
                                        if (requestedQuantity < 1) {
                                            return; // Prevent decrement below 1
                                        }

                                        // Check availability based on the updated requested quantity
                                        checkAvailability(item.id, item.productSize, item.productColor, requestedQuantity, (isAvailable, availableQty) => {
                                            if (isAvailable) {
                                                // If the item is available and stock is sufficient, update the cart
                                                item.quantity = requestedQuantity; // Update quantity based on the requested quantity
                                                cart[index] = item;

                                                // Update local storage
                                                localStorage.setItem("cart", JSON.stringify(cart));

                                                // Update UI
                                                const quantitySpan = document.querySelector(`#qty-${item.id}`);
                                                const priceSpan = document.querySelector(`#price-${item.id}`);
                                                quantitySpan.textContent = `Qty: ${item.quantity}`;
                                                priceSpan.textContent = `${(parseFloat(item.price.replace(" EGP", "")) * item.quantity).toFixed(2)} EGP`;

                                                // Refresh total amount
                                                updateTotalAmount();
                                                location.reload(); // Reload to reflect changes
                                            }
                                        });

                                    }

                                    // Function to update item quantity in local storage
                                    function updateLocalDbItemQuantity(itemId, newQuantity) {
                                        // Find the item in local cart by id and update it

                                        const itemIndex = cart.findIndex(item => item.id === itemId);
                                        if (itemIndex !== -1) {
                                            // Check if the new quantity is less than the current quantity
                                            if (newQuantity < cart[itemIndex].quantity) {
                                                // Update the quantity to the new allowed quantity
                                                cart[itemIndex].quantity = newQuantity;
                                            }

                                            // Update the cart in local storage
                                            localStorage.setItem("cart", JSON.stringify(cart));

                                            // Optionally, update the UI immediately
                                            const quantitySpan = document.querySelector(`#qty-${itemId}`);
                                            const priceSpan = document.querySelector(`#price-${itemId}`);
                                            if (quantitySpan) {
                                                quantitySpan.textContent = `Qty: ${cart[itemIndex].quantity}`;
                                            }
                                            if (priceSpan) {
                                                priceSpan.textContent = `${(parseFloat(cart[itemIndex].price.replace(" EGP", "")) * cart[itemIndex].quantity).toFixed(2)} EGP`;
                                            }
                                        }
                                    }
                                    // Function to update the total amount
                                    function updateTotalAmount() {
                                        totalAmount = cart.reduce((acc, item) => acc + parseFloat(item.price.replace(" EGP", "")) * item.quantity, 0);
                                        const totalAmountDiv = document.getElementById("total-cart-amount");
                                        if (totalAmountDiv) {
                                            totalAmountDiv.innerText = `Total : ${totalAmount.toFixed(2)} EGP`;
                                        }
                                    }

                                    // Populate cart items
                                    if (cart.length > 0) {

                                        cart.forEach((item, index) => {
                                            const listItem = document.createElement("li");

                                            // Item details
                                            const itemDetailsDiv = document.createElement("div");
                                            itemDetailsDiv.classList.add("flex", "center", "align-items");

                                            // Image
                                            const imageDiv = document.createElement("div");
                                            const itemImage = document.createElement("img");
                                            itemImage.src = item.photourl;
                                            itemImage.classList.add("pointer");
                                            itemImage.onclick = () => productDetails(item.id);
                                            imageDiv.appendChild(itemImage);
                                            itemDetailsDiv.appendChild(imageDiv);

                                            // Text
                                            const textDiv = document.createElement("div");
                                            textDiv.classList.add("Product-record");
                                            textDiv.innerHTML = `
                                                                            <h5>${item.brand}</h5>
                                                                            <p class="cart-font-smaller">${item.title}</p>
                                                                            <p>Size: ${item.productSize}</p>
                                                                            <p>Color: ${item.productColor}</p>
                                                                            <p id="price-${item.id}">${(parseFloat(item.price.replace(" EGP", "")) * item.quantity).toFixed(2)} EGP</p>
                                                                            <p id="qty-${item.id}">Qty: ${item.quantity}</p>
                                                                        `;
                                            itemDetailsDiv.appendChild(textDiv);

                                            // Controls Div to hold Increment, Decrement, and Delete buttons
                                            const controlsDiv = document.createElement("div");
                                            controlsDiv.style.display = "flex";
                                            controlsDiv.style.gap = "10px"; // Add spacing between buttons
                                            controlsDiv.style.alignItems = "center"; // Align buttons vertically
                                            controlsDiv.style.justifyContent = "center"; // Center the buttons in the div

                                            // Increment Button
                                            const incrementBtn = document.createElement("i");
                                            incrementBtn.className = "bi-plus-circle i-cart";
                                            incrementBtn.style.cursor = "pointer";
                                            incrementBtn.onclick = () => updateQuantity(index, 1); // Increment quantity

                                            // Decrement Button
                                            const decrementBtn = document.createElement("i");
                                            decrementBtn.className = "bi-dash-circle i-cart";
                                            decrementBtn.style.cursor = "pointer";
                                            decrementBtn.onclick = () => updateQuantity(index, -1); // Decrement quantity

                                            // Delete Button
                                            const deleteIcon = document.createElement("i");
                                            deleteIcon.className = "bi-bag-dash i-cart";
                                            deleteIcon.style.cursor = "pointer";
                                            deleteIcon.onclick = () => {
                                                cart.splice(index, 1);
                                                localStorage.setItem("cart", JSON.stringify(cart));
                                                listItem.remove();
                                                updateTotalAmount();
                                                window.location.reload();
                                            };

                                            // Append all buttons to controlsDiv
                                            controlsDiv.appendChild(decrementBtn);
                                            controlsDiv.appendChild(incrementBtn);
                                            controlsDiv.appendChild(deleteIcon);

                                            // Append controlsDiv to itemDetailsDiv
                                            itemDetailsDiv.appendChild(controlsDiv);

                                            // Append itemDetailsDiv to listItem
                                            listItem.appendChild(itemDetailsDiv);

                                            // Append listItem to cart list
                                            cartList.appendChild(listItem);

                                        });

                                        // Total Amount
                                        const totalAmountH5 = document.getElementById("total-cart-amount");
                                        totalAmountH5.textContent = `Cart Total : ${totalAmount.toFixed(2)} EGP`;

                                        // Initial total amount calculation
                                        updateTotalAmount();
                                    } else {
                                        cartList.textContent = "Your cart is empty";
                                        cartArea.classList.add("flex", "center", "align-items");
                                    }
                                });
                            </script>


                        </div>




                    </div>
                    <div class="m-10 flex center">
                        <h5 id="total-cart-amount"></h5>
                    </div>


                </div>
                <div class="flex center" id="next1Button">

                    <button id="addToCartButton" class="Add-to-Cart" onclick="Next1()" disabled1>Next
                        <i class="bi bi-arrow-right"></i>
                    </button>

                </div>
            </div>


            </script>
            <div id="Info-card" class="hidden">
                <div class="flex center  m-10  height-50 " id="Information">
                    <div class="width-90 padding-10 cart-bg over-flow-auto box-with-shadow " id="cartarea">
                        <div class="m-10 flex center align-items">
                            <h3>Personal Information</h3>
                        </div>

                        <div class="flex center flex-wrap">
                            <div class="fit-content m-5">
                                <h5 class="h5-form">First-Name</h5>
                                <input type="text" id="firstName" name="First-name" required="" class="input-cart">
                            </div>
                            <div class="fit-content m-5">
                                <h5 class="h5-form">Last-Name</h5>
                                <input type="text" id="lastName" name="Last-name" required="" class="input-cart">
                            </div>
                            <div class="fit-content m-5">
                                <h5 class="h5-form">Email</h5>
                                <input type="email" id="email" name="email" required="" class="input-cart">
                            </div>
                            <div class="fit-content m-5">
                                <h5 class="h5-form">Phone-Number</h5>
                                <input type="text" id="phoneNumber" name="Phone-number" required="" class="input-cart">
                            </div>
                            <div class="fit-content m-5">
                                <h5 class="h5-form">House-Phone-Number</h5>
                                <input type="text" id="housePhoneNumber" name="House-phone-number"
                                    placeholder="optional.." class="input-cart">
                            </div>
                            <div class="fit-content m-5">
                                <h5 class="h5-form">Government</h5>
                                <select id="city" name="city" required="" class="input-cart select-city">
                                    <option value="Cairo">Cairo</option>
                                    <option value="Giza">Giza</option>
                                    <option value="Alexandria">Alexandria</option>
                                    <option value="Al-Sharqia">Al-Sharqia</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                            <div class="fit-content m-5">
                                <h5 class="h5-form">Area</h5>
                                <input type="text" id="area" name="text" placeholder="ex: el-kawmia" required=""
                                    class="input-cart">
                            </div>
                            <div class="fit-content m-5">
                                <h5 class="h5-form">House-Number</h5>
                                <input type="text" id="houseNumber" name="text" placeholder="ex:11" required=""
                                    class="input-cart">
                            </div>
                            <div class="fit-content m-5">
                                <h5 class="h5-form">Floor-Number</h5>
                                <input type="text" id="floorNumber" name="text" placeholder="ex:3" required=""
                                    class="input-cart">
                            </div>
                        </div>
                        <div class="">
                            <div class="fit-content m-5 width-available">
                                <h5>Address</h5>
                                <textarea id="address" name="text" required=""
                                    class="input-cart textarea-address width-available"></textarea>
                            </div>
                        </div>

                        <div class="flex center">
                            <span class="small-txt m-5 txt-center line-height-15"> you can delete Stored information by
                                clicking here <i onclick="removePersonalInfo()"
                                    class="bi bi-eraser pointer  icon-hov-del"></i>
                            </span>
                            <script>
                                function removePersonalInfo() {
                                    localStorage.removeItem('personal_info');
                                    Swal.fire({
                                        icon: 'success',
                                        title: 'Deleted',
                                        showConfirmButton: false,
                                        timer: 1500 // Close the alert after 1.5 seconds
                                    });
                                    // Optionally, you can also clear the form fields here
                                }
                            </script>
                        </div>
                    </div>

                    <script>
                        document.addEventListener('DOMContentLoaded', function () {
                            // Load form data from local storage
                            loadpersonal_info();

                            // Add event listeners to save data when input changes
                            document.querySelectorAll('.input-cart').forEach(input => {
                                input.addEventListener('input', savepersonal_info);
                                input.addEventListener('input', checkFormValidity);
                            });
                            document.querySelectorAll('.select-city').forEach(select => {
                                select.addEventListener('change', savepersonal_info);
                                select.addEventListener('change', checkFormValidity);
                            });

                            // Initially check form validity
                            checkFormValidity();
                        });

                        function savepersonal_info() {
                            let personal_info = {
                                firstName: document.getElementById('firstName').value,
                                lastName: document.getElementById('lastName').value,
                                email: document.getElementById('email').value,
                                phoneNumber: document.getElementById('phoneNumber').value,
                                housePhoneNumber: document.getElementById('housePhoneNumber').value,
                                city: document.getElementById('city').value,
                                area: document.getElementById('area').value,
                                houseNumber: document.getElementById('houseNumber').value,
                                floorNumber: document.getElementById('floorNumber').value,
                                address: document.getElementById('address').value
                            };

                            // Save form data to local storage
                            localStorage.setItem('personal_info', JSON.stringify(personal_info));
                        }

                        function loadpersonal_info() {
                            let personal_info = JSON.parse(localStorage.getItem('personal_info'));

                            if (personal_info) {
                                document.getElementById('firstName').value = personal_info.firstName || '';
                                document.getElementById('lastName').value = personal_info.lastName || '';
                                document.getElementById('email').value = personal_info.email || '';
                                document.getElementById('phoneNumber').value = personal_info.phoneNumber || '';
                                document.getElementById('housePhoneNumber').value = personal_info.housePhoneNumber || '';
                                document.getElementById('city').value = personal_info.city || '';
                                document.getElementById('area').value = personal_info.area || '';
                                document.getElementById('houseNumber').value = personal_info.houseNumber || '';
                                document.getElementById('floorNumber').value = personal_info.floorNumber || '';
                                document.getElementById('address').value = personal_info.address || '';
                            }
                        }

                        function checkFormValidity() {
                            const requiredFields = ['firstName', 'lastName', 'email', 'phoneNumber', 'city', 'area', 'address'];
                            let isValid = true;

                            requiredFields.forEach(field => {
                                const input = document.getElementById(field);
                                if (!input.value.trim()) {
                                    isValid = false;
                                }
                            });

                            const nextButton = document.getElementById('nextButton');
                            if (isValid) {
                                nextButton.style.opacity = 1;
                                nextButton.disabled = false;
                            } else {
                                nextButton.style.opacity = 0.5;
                                nextButton.disabled = true;
                            }
                        }
                    </script>
                </div>

                <div class="flex center  m-10  height-auto" id="Information">
                    <div class="width-90 padding-10 cart-bg over-flow-auto box-with-shadow " id="cartarea">
                        <div class="m-10 flex center align-items">
                            <h3>Shipping Information</h3>
                        </div>

                        <div class="flex center align-items m-10">
                            <h5 class="small-txt  txt-center line-height-15 flex align-items">
                                shipping fees will be :
                                <h5 id="shipping-fees" class="ml-3"></h5>
                            </h5>
                        </div>
                        <div class="flex center align-items m-10">
                            <button id="addToCartButton" class="Add-to-Cart font-smaller flex center align-items"
                                onclick="showMoreShippingData()">
                                <p class="font-smaller" id="shiptxtinfo">Show More Info</p>
                                <i id="shippininfoicon" class="bi bi-plus"></i>
                            </button>
                        </div>

                        <div class="hidden" id="shippingInfo">
                            <div class="flex center align-items">
                                <span class="small-txt m-5 txt-center line-height-15 flex align-items">
                                    - Your shipment is expected to arrive within a maximum of four days from the date of
                                    your order!
                                </span>
                            </div>
                            <div class="flex-column flex-grow">
                                <div class="flex center">
                                    <span class="small-txt m-5 txt-center line-height-15">The shipping cost will be 100
                                        EGP - if your
                                        Government is not Cairo</span>
                                </div>
                                <div class="flex center">
                                    <span class="small-txt m-5 txt-center line-height-15 flex">- Free shipping on orders
                                        over
                                        <div class="m-x-3" id="free-shipping"></div>
                                        EGP
                                    </span>
                                </div>
                            </div>
                        </div>
                        <script>
                            function showMoreShippingData() {
                                const shippingInfo = document.getElementById('shippingInfo');
                                const addToCartButton = document.getElementById('shiptxtinfo');
                                const icon = document.getElementById('shippininfoicon');
                                icon.classList = '';

                                if (shippingInfo) {
                                    if (shippingInfo.classList.contains('hidden')) {
                                        shippingInfo.classList.remove('hidden');
                                        addToCartButton.innerHTML = 'Hide Shipping Info';
                                        icon.classList = 'bi bi-dash';
                                    } else {
                                        shippingInfo.classList.add('hidden');
                                        addToCartButton.innerHTML = 'Show More Info';
                                        icon.classList = 'bi bi-plus';
                                    }
                                }
                            }



                            // Call the function when the page loads
                            document.addEventListener('DOMContentLoaded', updateShippingFees);

                            // Call the function when the city select changes
                            document.getElementById("city").addEventListener("change", updateShippingFees);


                        </script>
                    </div>
                </div>
                <div class="flex center" id="next2Button">
                    <button type="button" class="Add-to-Cart" id="perv1Button" onclick="perv1()">
                        <i class="bi bi-arrow-left"></i>
                    </button>
                    <button id="nextButton" class="Add-to-Cart" onclick="Next2()" disabled style="opacity: 0.5;">
                        Next <i class="bi bi-arrow-right"></i>
                    </button>
                </div>
            </div>


            <div id="summary-card" class="hidden">
                <div class="flex center m-10 " id="Summary">
                    <div class="width-90 cart-bg over-flow-auto box-with-shadow " id="cartarea">
                        <div class="m-10 flex center">
                            <h3>Order Summary</h3>
                        </div>
                        <div class="m-20 flex center align-items  m-10">
                            <h5>Cart Total :</h5><span id="cart-total" class="ml-3"></span>
                        </div>
                        <div class="m-20 flex center align-items  m-10">
                            <h5>Shipping Fees :</h5><span id="shipping-fees-total" class="ml-3"></span>
                        </div>
                        <div class="m-20 flex center align-items m-10">
                            <h5>Total Price :</h5><span id="total-price" class="ml-3"></span>
                        </div>

                    </div>
                </div>
                <div class="flex center " id="next3Button">
                    <button type="button" class="Add-to-Cart" id="perv3Button" onclick="perv2()">
                        <i class="bi bi-arrow-left"></i>
                    </button>
                    <button id="Next3" class="Add-to-Cart" onclick="Next3()">Next
                        <i class="bi bi-arrow-right"></i>
                    </button>
                </div>
                <script>

                    function updateCartSummary() {
                        // Retrieve cart items from localStorage
                        let cart = localStorage.getItem('cart');

                        // Check if the cart is not empty
                        if (cart) {
                            // Parse the JSON string into an array
                            cart = JSON.parse(cart);

                            // Initialize total price
                            let totalPrice = 0;

                            // Iterate through cart items and sum up the prices
                            cart.forEach(item => {
                                // Extract the numeric value from the price string and convert it to a number
                                let price = parseFloat(item.price.replace(' EGP', ''));
                                totalPrice += price;
                            });

                            // Update the cart total element in the DOM
                            document.getElementById('cart-total').innerText = `${totalPrice} EGP`;

                            // Retrieve the shipping fees from the DOM and convert it to a number
                            let shippingFees = parseFloat(document.getElementById('shipping-fees-total').innerText);

                            // Calculate the final price
                            let finalPrice = totalPrice + shippingFees;

                            // Update the total price element in the DOM
                            document.getElementById('total-price').innerText = `${finalPrice} EGP`;
                        }
                    }

                    // Function to observe changes in the shipping fees element
                    function observeShippingFees() {
                        const shippingFeesElement = document.getElementById('shipping-fees-total');
                        const observer = new MutationObserver(updateCartSummary);

                        // Observe changes to the text content of the shipping fees element
                        observer.observe(shippingFeesElement, { childList: true, characterData: true, subtree: true });
                    }

                    // Call the function to update the shipping fees on page load
                    window.onload = function () {
                        updateShippingFees();
                        observeShippingFees();
                    };

                    // Add event listener to update shipping fees when the city select changes
                    document.getElementById("city").addEventListener("change", updateShippingFees);
                </script>

            </div>

            <div id="Payment-card" class="hidden">
                <div class="flex center width-auto m-10" id="Payment">

                    <div class="width-90 cart-bg padding-10 over-flow-auto box-with-shadow flex align-items flex-direction-column center"
                        id="cartarea">
                        <div class="m-10">
                            <h3>Payment Method</h3>
                        </div>

                        <div class="flex center">
                            <div class="flex center col-u-991">
                                <div class="flex center p-10 flex-direction-column align-items" id="cash">
                                    <img class="img-payment payment-option"
                                        src="https://i.imgur.com/TYOv2Mm_d.webp?maxwidth=760&fidelity=grand">
                                    <h5 class="mt-10">Cash on Delivery</h5>
                                </div>
                                <div class="flex center p-10 flex-direction-column align-items disabled" id="visa">
                                    <div class="overlay2">Coming Soon</div>
                                    <img class="img-payment "
                                        src="https://i.imgur.com/HfWCw1n_d.webp?maxwidth=760&fidelity=grand">
                                    <h5 class="mt-10">Pay With Visa</h5>
                                </div>
                                <div class="flex center p-10 flex-direction-column align-items disabled" id="fawry">
                                    <div class="overlay2">Coming Soon</div>
                                    <img class="img-payment "
                                        src="https://i.imgur.com/QsmNvfF_d.webp?maxwidth=760&fidelity=grand">
                                    <h5 class="mt-10">Pay With Fawry</h5>
                                </div>
                            </div>

                            <script>
                                // Get all payment options
                                let paymentOptions = document.querySelectorAll('.payment-option');

                                // Add click event listener to each payment option
                                paymentOptions.forEach(option => {
                                    option.addEventListener('click', function () {
                                        // Remove green border from all payment options
                                        paymentOptions.forEach(opt => {
                                            opt.classList.remove('selected');
                                        });

                                        // Add green border to the clicked payment option
                                        this.classList.add('selected');
                                    });
                                });

                            </script>
                        </div>
                        <script>
                            document.addEventListener('DOMContentLoaded', function () {
                                // Select the Visa and Fawry payment option elements
                                const visaOption = document.getElementById('visa');
                                const fawryOption = document.getElementById('fawry');

                                // Add the 'disabled' class to both elements
                                visaOption.classList.add('disabled');
                                fawryOption.classList.add('disabled');
                            });
                        </script>
                    </div>
                </div>
                <div class="flex center " id="submit-order">
                    <button type="button" class="Add-to-Cart" id="perv4Button" onclick="perv3()">
                        <i class="bi bi-arrow-left"></i>
                    </button>
                    <button id="Submit" class="Add-to-Cart" onclick="submitOrder()">Submit Order
                        <i class="bi bi-check2-all"></i>
                    </button>

                    <!-- Firebase Configuration and Script -->
                    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
                    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
                    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
                    <script src="./assets/js/submit-order.js"></script>




                </div>
            </div>

        </section>
    </div>
    <div class="flex center">
        <a href="https://matager.online" target="_blank">
            <img src="./assets/images/powerd by matager black.svg" width="100px">
        </a>
    </div>






    <!-- <script>
        // navigation js
        function Next1() {
            // Hide the Cart section and Next1 button
            document.getElementById('cart-card').classList.add('hidden');
            document.getElementById('Info-card').classList.remove('hidden');
            document.getElementById('summary-card').classList.add('hidden');
            document.getElementById('Payment-card').classList.add('hidden');



            document.getElementById('target-1').classList.remove('targeted-step');
            document.getElementById('target-2').classList.add('targeted-step');
            document.getElementById('target-3').classList.remove('targeted-step');
            document.getElementById('target-4').classList.remove('targeted-step');

            document.getElementById('connector1').classList.add('connector-after');
            document.getElementById('connector2').classList.remove('connector-after');
            document.getElementById('connector3').classList.remove('connector-after');

        }

        function Next2() {
            document.getElementById('cart-card').classList.add('hidden');
            document.getElementById('Info-card').classList.add('hidden');
            document.getElementById('summary-card').classList.remove('hidden');
            document.getElementById('Payment-card').classList.add('hidden');


            document.getElementById('target-1').classList.remove('targeted-step');
            document.getElementById('target-2').classList.remove('targeted-step');
            document.getElementById('target-3').classList.add('targeted-step');
            document.getElementById('target-4').classList.remove('targeted-step');

            document.getElementById('connector1').classList.add('connector-after');
            document.getElementById('connector2').classList.add('connector-after');
            document.getElementById('connector3').classList.remove('connector-after');
        }
        function Next3() {
            document.getElementById('cart-card').classList.add('hidden');
            document.getElementById('Info-card').classList.add('hidden');
            document.getElementById('summary-card').classList.add('hidden');
            document.getElementById('Payment-card').classList.remove('hidden');

            document.getElementById('target-1').classList.remove('targeted-step');
            document.getElementById('target-2').classList.remove('targeted-step');
            document.getElementById('target-3').classList.remove('targeted-step');
            document.getElementById('target-4').classList.add('targeted-step');

            document.getElementById('connector1').classList.add('connector-after');
            document.getElementById('connector2').classList.add('connector-after');
            document.getElementById('connector3').classList.add('connector-after');

        }
        function perv1() {
            document.getElementById('cart-card').classList.remove('hidden');
            document.getElementById('Info-card').classList.add('hidden');
            document.getElementById('summary-card').classList.add('hidden');
            document.getElementById('Payment-card').classList.add('hidden');

            document.getElementById('target-1').classList.add('targeted-step');
            document.getElementById('target-2').classList.remove('targeted-step');
            document.getElementById('target-3').classList.remove('targeted-step');
            document.getElementById('target-4').classList.remove('targeted-step');



            document.getElementById('connector1').classList.add('connector-after');
            document.getElementById('connector2').classList.remove('connector-after');
            document.getElementById('connector3').classList.remove('connector-after');

        }
        function perv2() {
            document.getElementById('cart-card').classList.add('hidden');
            document.getElementById('Info-card').classList.remove('hidden');
            document.getElementById('summary-card').classList.add('hidden');
            document.getElementById('Payment-card').classList.add('hidden');

            document.getElementById('target-1').classList.remove('targeted-step');
            document.getElementById('target-2').classList.add('targeted-step');
            document.getElementById('target-3').classList.remove('targeted-step');
            document.getElementById('target-4').classList.remove('targeted-step');

            document.getElementById('connector2').classList.remove('connector-after');

        }
        function perv3() {
            document.getElementById('cart-card').classList.add('hidden');
            document.getElementById('Info-card').classList.add('hidden');
            document.getElementById('summary-card').classList.remove('hidden');
            document.getElementById('Payment-card').classList.add('hidden');

            document.getElementById('target-1').classList.remove('targeted-step');
            document.getElementById('target-2').classList.remove('targeted-step');
            document.getElementById('target-3').classList.add('targeted-step');
            document.getElementById('target-4').classList.remove('targeted-step');

            document.getElementById('connector3').classList.remove('connector-after');

        }

        // navigation js

    </script> -->
    <!-- // -->
    <script>
        // Manage step navigation
        function goToStep(step) {
            const steps = ['cart-card', 'Info-card', 'summary-card', 'Payment-card'];
            const targets = ['target-1', 'target-2', 'target-3', 'target-4'];
            const connectors = ['connector1', 'connector2', 'connector3'];

            // Hide all steps and remove 'targeted-step' class
            steps.forEach((id, index) => {
                const card = document.getElementById(id);
                const target = document.getElementById(targets[index]);

                if (card) card.classList.add('hidden');
                if (target) target.classList.remove('targeted-step');
            });

            // Show current step
            const currentCard = document.getElementById(steps[step - 1]);
            const currentTarget = document.getElementById(targets[step - 1]);
            if (currentCard) currentCard.classList.remove('hidden');
            if (currentTarget) currentTarget.classList.add('targeted-step');

            // Update connectors
            connectors.forEach((id, index) => {
                const connector = document.getElementById(id);
                if (connector) {
                    connector.classList.toggle('connector-after', index < step - 1);
                }
            });
        }

        // Previous and Next functions
        function Next1() {
            goToStep(2);
        }

        function Next2() {
            goToStep(3);
        }

        function Next3() {
            goToStep(4);
        }

        function perv1() {
            goToStep(1);
        }

        function perv2() {
            goToStep(2);
        }

        function perv3() {
            goToStep(3);
        }
    </script>

    </section>



    </div>
</main>

<a href="#top" class="go-top-btn" data-go-top="">
    <ion-icon name="arrow-up-outline" role="img" class="md hydrated" aria-label="arrow up outline"></ion-icon>
</a>

<script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
<script nomodule="" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>

<script>
    function showPreloader() {
        document.getElementById('preloader').classList.remove('hidden');


    }

    // Function to hide preloader
    function hidePreloader() {
        document.getElementById('preloader').classList.add('hidden');


    }

    // Fetch product details after 2 seconds
    setTimeout(() => {

        hidePreloader(); // Hide preloader after 2 seconds
        // Fetch product details
    }, 1000);
</script>
<script src="./assets/js/update-cart-amont.js"></script>
<script src="./assets/js/route.js"></script>
<script src="./assets/js/all.js"></script>
<script src="./assets/js/rendering-megamenu.js"></script>
<script src="./assets/js/rendering-search.js"></script>